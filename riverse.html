<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Riverse</title>
    <link rel="stylesheet" href="styles.css"> <!-- Links to same CSS file -->
</head>

<body>
    <!-- Swirls (optional, for consistency) -->
    <div class="swirl-line"></div>
    <div class="swirl-line"></div>

    <div class="hover-image secret2">
        <img src="Content/Images/ddslogo.png" alt="Hidden image">
    </div>

    <!-- Navigation bar (copy from main page) -->
    <nav>
        <ul>
            <li><a href="index.html">Projects</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="contact.html">Contact</a></li>
        </ul>
    </nav>

    <!-- Big header title -->
    <!-- <div class="page-header">
        <h1>Riverse</h1>
    </div> -->

    <!-- Big header title -->
    <div class="page-header">
        <img src="Content/Images/rivtitle.png" alt="Riverse">
    </div>

    <div class="content-border">
        <div class="border-top"></div>
        <div class="border-content">
            <!-- Your images and text go here -->
            <p><b>About:</b></p>
            <p>
                Riverse is made in my first year at buas with a group of 12 people in the unreal engine game engine,
                we got certain reference games<br>
                to choose from and we choosed for Cluster truck.<br>
                We had 8 weeks the time to concept the game, work it out and to make it.<br>
                The game is a fast past platform game where you have to reach the goal as fast as possible<br>
                by jumping from platform to platform, abvoiding obstacles and rewinding hinders with your pocketwatch.
            </p>

            <br>

            <p><b>Creation I made:</b></p>
            <p>
                In this project I created the time rewind feature. The feature has the ability to set groups of object
                that can be rewinded, with this
                you can look at a rewindable object then every other object in the same group will be highlighted
                showing that those objects will be
                rewinded back in time when you activate the rewind. I have chosen for this option so you could control
                what to rewind, this fitted with our
                design to give it a better player experience.
            </p>

            <br>

            <details open>
                <summary></summary>
                <pre><code class="language-cpp">
void UBPC_TimeRewind::PlaySnapshots(float _deltaTime, bool _isRewinding, float _worldTime)
{
	if (hasReachedEnd)
		return;

	if (currentIndex == endIndex)
	{
		hasReachedEnd = true;
		return;
	}
	else
	{
		int prefIndex2 = currentIndex - 1;
		if (hasLooped)
		{
			if (prefIndex2 < 0)
				prefIndex2 = maxSnapshots - 1;
		}
		else
		{
			if (prefIndex2 < 0)
				prefIndex2 = 0;
		}

		if (_worldTime < snapshots[prefIndex2].worldTime)
		{
			if (!snapshots[currentIndex].isInvalid)
				if (currentIndex != endIndex)
				{
					snapshots[currentIndex].isInvalid = true;
					currentIndex--;
					if (currentIndex < 0)
						currentIndex = maxSnapshots - 1;
				}
		}


		int prefIndex = currentIndex - 1;
		if (hasLooped)
		{
			if (prefIndex < 0)
				prefIndex = maxSnapshots - 1;
		}
		else
		{
			if (prefIndex < 0)
				prefIndex = 0;
		}

		const FsnapShots& curSnap = snapshots[currentIndex];
		const FsnapShots& prefSnap = snapshots[prefIndex];

		float alpha = (curSnap.worldTime - _worldTime) / (curSnap.worldTime - prefSnap.worldTime);

		//lerping
		FVector position = FMath::Lerp(curSnap.position, prefSnap.position, alpha);
		FRotator rotation = FMath::Lerp(curSnap.rotation, prefSnap.rotation, alpha);

		ownerRootComponent->SetWorldLocationAndRotation(position, rotation);
	}
}
            </code></pre>
            </details>

            <br>

            <!--Videos-->
            <div class="content-row">
                <div class="page-game rivv1">
                    <video controls width="400">
                        <source src="Content/Videos/DuckRewinds.mp4" type="video/mp4">
                    </video>
                </div>

                <div class="text-beside">
                    <p><b>Objects test:</b></p>
                    <p>The PlaySnapshot function makes sures that the recorded data is applied to the object correctly.<br>
                    it does this by using a circular buffer using indexes. It grabs a snapshot checks it with the worldtime<br>
                    if it went far enough backwards in time then the current snapshot becomes invalid and it goes to the next<br>
                    snapshot. It loops the index and applies the position and rotation with lerping to the object.<br>
                    The video shows a test with many objects recording and rewinding at the same time to see if the system can<br>
                    handle that.</p>
                </div>
            </div>

            <br>

            <details open>
                <summary></summary>
                <pre><code class="language-cpp">
void UBPC_TimeRewind::RecordSnapshot(float _deltaTime, float _worldTime)
{
	FsnapShots snapShot;

	snapShot.position = ownerRootComponent->GetComponentLocation();
	snapShot.rotation = ownerRootComponent->GetComponentRotation();
	if (ownerRootComponent->IsSimulatingPhysics())
	{
		snapShot.velocity = ownerRootComponent->GetPhysicsLinearVelocity();
		snapShot.angularVelocity = ownerRootComponent->GetPhysicsAngularVelocityInRadians();
	}
	snapShot.worldTime = _worldTime;
	snapShot.isInvalid = false;

	snapshots[currentIndex] = snapShot;

	currentIndex++;

	if (currentIndex >= maxSnapshots)
	{
		currentIndex = 0;
		hasLooped = true;
	}

	snapshots[currentIndex].isInvalid = false;//
}
            </code></pre>
            </details>

            <br>

            <div class="content-row">
                <div class="page-game rivv2">
                    <video controls width="400">
                        <source src="Content/Videos/GroupRewind.mp4" type="video/mp4">
                    </video>
                </div>

                <div class="text-beside">
                    <p><b>Group test:</b></p>
                    <p>The RecordSnapshot function records the neccesary data of that object that needs to be rewinded.<br>
                    It does this by creating a local snapshot, giving it all the values it needs and then applying it to<br>
                    the snapshots buffer. it then increases the index and if needed loops it.<br>
                    The video to the side shows a test where 2 groups of rewindable objecs are shown. You aim at a object<br>
                    in that group and then when you rewind, all those objects will rewind back in time.<br>
                    without the other group being rewinded.</p>
                </div>
            </div>

            <br>

            <div class="content-row">
                <div class="page-game rivv3">
                    <video controls width="400">
                        <source src="Content/Videos/RewindInProject.mp4" type="video/mp4">
                    </video>
                </div>

                <div class="text-beside">
                    <p><b>In the game:</b></p>
                    <p>The video shows how it looks in the game with highliting a group that can be rewinded.</p>
                </div>
            </div>

            <br>

            <p><b>My thoughts:</b></p>
            <p>
                Making this feature in unreal engine was a fun challenge to do. I hadn't used c++ in ureal engine a lot before so it<br>
                figuring out how to use it was very interesting and i learned a lot from it. 
            </p>

            <br>

            <a href="https://buas.itch.io/team-bludhaven" target="_blank">Itch.io page of Riverse</a>

            <!--Images-->

            <div class="page-game rivi1">
                <img src="Content/Images/M3LevelRiv.PNG" alt="T1">
            </div>

        </div>
        <div class="border-bottom"></div>
    </div>

</body>

</html>